---
import BasicLayout from "@/layouts/BasicLayout.astro";
import { getValidPosts } from "@/helpers/posts";
import { getCollection } from "astro:content";

/* 
  https://github.com/withastro/astro/blob/latest/examples/blog/src/components/FormattedDate.astro
*/

const allPosts = await getCollection("blogs");
const posts = getValidPosts(allPosts);
---

<BasicLayout>
  <div class="container">
    {
      (
        <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 15px 0">
          {posts.map((post) => {
            const date = new Date(post.data.pubDate);
            const formattedDate = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, "0")}-${String(date.getDate()).padStart(2, "0")}`;

            return (
              <a class="post" href={`posts/${post.slug}`}>
                <img
                  src={post.data.image?.src ?? "https://picsum.photos/1600/900"}
                  alt={post.data.image?.alt}
                />
                <div class="gradient" />

                <div class="info">
                  <h2>
                    <p>{post.data.title}</p>
                  </h2>
                  <p>{formattedDate}</p>
                </div>
              </a>
            );
          })}
        </div>
      )
    }
  </div>
</BasicLayout>

<style>
  .container {
    padding: 2rem;
    .post {
      --width: 700px;
      --height: 400px;

      position: relative;
      max-width: 100%;
      width: var(--width);
      height: var(--height);

      &:hover {
        cursor: pointer;
        transform: scale(1.01);
        transition: transform 0.5s;
      }

      .gradient {
        position: relative;
        top: 0;
        left: 0;
        max-width: 100%;
        width: var(--width);
        height: var(--height);
        background: linear-gradient(
          to top,
          rgba(0, 0, 0, 0.5) 0%,
          rgba(0, 0, 0, 0) 100%
        );
        border-radius: 10px;
      }
      img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
      }

      .info {
        position: absolute;
        bottom: 10px;
        left: 10px;
        color: white;

        a {
          color: white;
          text-decoration: none;
        }

        p {
          margin: 0;
        }
      }

      @media (max-width: 576px) {
        height: calc(var(--height) / 2);

        .gradient {
          height: calc(var(--height) / 2);
        }

        h2 {
          margin: 5px 0;
          font-size: 1.2rem;
        }
      }
    }
  }
</style>
