---
import RadialProgressContainer from "./RadialProgressContainer.astro";
---

<!-- <div
  class="bg-red w-full h-full flex justify-center px-8 py-16 gap-8 sm:bg-slate-300"
> -->
<section
  class="w-full h-full flex flex-col items-center px-8 py-16 gap-8 md:flex-row md:justify-center md:items-start"
>
  <RadialProgressContainer
    text="Professionality"
    number="+23"
    subText="Países visitados viviendo experiencias únicas"
  />
  <RadialProgressContainer
    text="Quality"
    number="+10"
    subText="Trabajos realizados con éxito para distintas empresas"
  />
  <RadialProgressContainer
    text="Edition"
    number="+50"
    subText="Fotos editadas"
  />
</section>

<script>
  const loadScript = () => {
    const minimumAnimationTime = 5; //ms
    const maxValue = 100;

    // search first div with class radial-progress that doesnt have the data-animated attribute
    const AllRadialProgress = document.querySelectorAll(
      ".radial-progress",
    ) as NodeListOf<HTMLDivElement>;

    if (!maxValue) throw new Error("maxValue is required");
    if (!AllRadialProgress) throw new Error("No radial-progress element found");

    // loop through all radial-progress elements
    for (let i = 0; i < AllRadialProgress.length; i++) {
      // now we are going to animate the radial progress every 100ms
      const radialProgress = AllRadialProgress[i];
      const interval = setInterval(
        () => {
          const radialProgressValue =
            radialProgress.style.getPropertyValue("--value");
          const value = Number(radialProgressValue);

          if (value >= maxValue) {
            clearInterval(interval);
            return;
          }

          radialProgress.style.setProperty("--value", `${value + 1}`);

          // change the text value
          const $text = radialProgress.querySelector("p");
          if ($text) {
            $text.textContent = `${value + 1}`;
          }
        },
        minimumAnimationTime + i * 1,
      );
    }
  };

  document.addEventListener("astro:page-load", loadScript);
</script>
